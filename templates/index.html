<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bullshit Detector</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #0f172a; /* Keep it dark */
      color: #e2e8f0;
    }
    
    /* Large gradient background for the entire page */
    .gradient-bg {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      min-height: 100vh;
      padding: 2rem 0;
    }

    /* Big, bold, gradient-filled title */
    .fancy-title {
      font-size: 2.5rem;        /* Large for desktop */
      font-weight: 700;
      text-align: center;
      margin-bottom: 0.5rem;
      background: linear-gradient(to right, #3b82f6, #8b5cf6);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    @media (min-width: 768px) {
      .fancy-title {
        font-size: 3rem;        /* Even bigger on medium+ screens */
      }
    }

    .card {
      background: rgba(30, 41, 59, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    .card:hover {
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
      transform: translateY(-2px);
    }

    .input-field {
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #e2e8f0;
      transition: all 0.3s ease;
    }
    .input-field:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
    }

    .submit-btn {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      transition: all 0.3s ease;
    }
    .submit-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.5);
    }

    .confidence-bar {
      height: 8px;
      background: #334155; /* Dark grey behind the bar */
      border-radius: 4px;
      overflow: hidden;
    }
    .confidence-level {
      height: 100%;
      border-radius: 4px;
      transition: width 0.5s ease-out;
    }
    .truth-high {
      background: linear-gradient(90deg, #22c55e, #16a34a);
    }
    .truth-medium {
      background: linear-gradient(90deg, #eab308, #ca8a04);
    }
    .truth-low {
      background: linear-gradient(90deg, #ef4444, #dc2626);
    }

    .model-response {
      border-left: 4px solid transparent;
      transition: all 0.3s ease;
      background-color: rgba(15, 23, 42, 0.7);
    }
    .model-openai   { border-left-color: #10b981; }
    .model-claude   { border-left-color: #8b5cf6; }
    .model-mistral  { border-left-color: #3b82f6; }
    .model-deepseek { border-left-color: #f59e0b; }

    .flag-emoji {
      font-size: 1.2em;
      margin-right: 8px;
    }

    .loader {
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top: 3px solid #3b82f6;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Mobile-friendly adjustments */
    @media (max-width: 640px) {
      .input-field {
        font-size: 14px;
        padding: 0.75rem 0.5rem;
      }
      .input-field::placeholder { font-size: 12px; }
      .submit-btn {
        padding: 0.5rem 0.75rem;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="gradient-bg">
    <div class="container mx-auto px-4">
      <header class="mb-12">
        <h1 class="fancy-title">Bullshit Detector</h1>
        <p class="text-gray-400 text-lg max-w-2xl mx-auto text-center">
          Verify claims across multiple AI models to detect truth from misinformation
        </p>
      </header>
      
      <div class="max-w-4xl mx-auto mb-12">
        <div class="card rounded-xl p-6 shadow-lg">
          <form id="query-form" class="space-y-4">
            <div>
              <label for="query" class="block text-sm font-medium text-gray-300 mb-2">
                Enter a claim to verify
              </label>
              <div class="relative">
                <input 
                  type="text" 
                  id="query" 
                  name="query" 
                  class="input-field w-full py-3 px-4 rounded-lg focus:outline-none" 
                  placeholder="Ex: Was the moon landing faked?"
                  required
                />
                <button 
                  type="submit" 
                  class="submit-btn absolute right-2 top-2 rounded-lg px-4 py-1 text-white font-medium"
                >
                  Verify
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
      
      <div id="results" class="max-w-4xl mx-auto hidden">
        <div class="card rounded-xl p-6 shadow-lg mb-8">
          <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
            <div>
              <h2 class="text-xl font-semibold mb-1" id="claim-text">Was the moon landing faked?</h2>
              <div class="flex items-center">
                <div id="verdict-badge" class="px-3 py-1 rounded-full bg-green-500 text-white text-sm font-medium mr-3">
                  FALSE
                </div>
                <div class="text-sm text-gray-400" id="confidence-text">HIGH Confidence</div>
              </div>
            </div>
            <div class="mt-4 md:mt-0 w-full md:w-1/3">
              <div class="confidence-bar">
                <div id="confidence-level" class="confidence-level truth-high" style="width: 95%"></div>
              </div>
              <div class="flex justify-between mt-1 text-xs text-gray-400">
                <span>Low</span>
                <span>Medium</span>
                <span>High</span>
              </div>
            </div>
          </div>
          
          <div id="model-responses" class="space-y-4">
            <!-- GPT-4o -->
            <div class="model-response model-openai rounded-lg p-4">
              <div class="flex items-center mb-3">
                <div class="w-8 h-8 rounded-full bg-gradient-to-r from-green-400 to-teal-500 flex items-center justify-center mr-3">
                  <i class="fas fa-robot text-white"></i>
                </div>
                <div class="flex flex-col">
                  <div class="flex items-center">
                    <span class="flag-emoji">ðŸ‡ºðŸ‡¸</span>
                    <div>
                      <h3 class="font-medium">GPT-4o</h3>
                      <div class="text-xs text-gray-400">OpenAI</div>
                    </div>
                  </div>
                  <div class="text-sm text-gray-300" id="gpt-training-age"></div>
                </div>
              </div>
              <p id="gpt-response" class="text-gray-300">
                Loading response...
              </p>
            </div>
            
            <!-- Claude 3 -->
            <div class="model-response model-claude rounded-lg p-4">
              <div class="flex items-center mb-3">
                <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-400 to-indigo-500 flex items-center justify-center mr-3">
                  <i class="fas fa-robot text-white"></i>
                </div>
                <div class="flex flex-col">
                  <div class="flex items-center">
                    <span class="flag-emoji">ðŸ‡ºðŸ‡¸</span>
                    <div>
                      <h3 class="font-medium">Claude 3</h3>
                      <div class="text-xs text-gray-400">Anthropic</div>
                    </div>
                  </div>
                  <div class="text-sm text-gray-300" id="claude-training-age"></div>
                </div>
              </div>
              <p id="claude-response" class="text-gray-300">
                Loading response...
              </p>
            </div>
            
            <!-- Mistral -->
            <div class="model-response model-mistral rounded-lg p-4">
              <div class="flex items-center mb-3">
                <div class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-400 to-blue-600 flex items-center justify-center mr-3">
                  <i class="fas fa-robot text-white"></i>
                </div>
                <div class="flex flex-col">
                  <div class="flex items-center">
                    <span class="flag-emoji">ðŸ‡«ðŸ‡·</span>
                    <div>
                      <h3 class="font-medium">Mistral</h3>
                      <div class="text-xs text-gray-400">Mistral AI</div>
                    </div>
                  </div>
                  <div class="text-sm text-gray-300" id="mistral-training-age"></div>
                </div>
              </div>
              <p id="mistral-response" class="text-gray-300">
                Loading response...
              </p>
            </div>
            
            <!-- DeepSeek -->
            <div class="model-response model-deepseek rounded-lg p-4 hidden">
              <div class="flex items-center mb-3">
                <div class="w-8 h-8 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 flex items-center justify-center mr-3">
                  <i class="fas fa-robot text-white"></i>
                </div>
                <div class="flex flex-col">
                  <div class="flex items-center">
                    <span class="flag-emoji">ðŸ‡¨ðŸ‡³</span>
                    <div>
                      <h3 class="font-medium">DeepSeek</h3>
                      <div class="text-xs text-gray-400">DeepSeek AI</div>
                    </div>
                  </div>
                  <div class="text-sm text-gray-300" id="deepseek-training-age"></div>
                </div>
              </div>
              <p id="deepseek-response" class="text-gray-300">
                Loading response...
              </p>
            </div>
          </div>
        </div>
        
        <div class="flex justify-between items-center">
          <button id="new-query-btn" class="text-blue-400 flex items-center">
            <i class="fas fa-arrow-left mr-2"></i> New Query
          </button>
          <div class="flex space-x-4">
            <button class="text-gray-400 hover:text-white transition">
              <i class="fas fa-share-alt"></i>
            </button>
            <button class="text-gray-400 hover:text-white transition">
              <i class="fas fa-download"></i>
            </button>
          </div>
        </div>
      </div>
      
      <div id="loading" class="max-w-4xl mx-auto text-center py-12 hidden">
        <div class="loader mx-auto mb-4"></div>
        <p class="text-gray-400">Analyzing with multiple AI models...</p>
      </div>
      
      <footer class="mt-16 text-center text-gray-500 text-sm">
        <p id="model-info" class="mb-2"></p>
        <p>Â© 2025 Bullshit Detector - AI-powered misinformation detection</p>
      </footer>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const queryForm = document.getElementById('query-form');
      const resultsSection = document.getElementById('results');
      const loadingSection = document.getElementById('loading');
      const newQueryBtn = document.getElementById('new-query-btn');
      const claimText = document.getElementById('claim-text');
      
      // Model responses
      const gptResponse = document.getElementById('gpt-response');
      const claudeResponse = document.getElementById('claude-response');
      const mistralResponse = document.getElementById('mistral-response');
      const deepseekResponse = document.getElementById('deepseek-response');
      
      // Model containers
      const gptContainer = document.querySelector('.model-openai');
      const claudeContainer = document.querySelector('.model-claude');
      const mistralContainer = document.querySelector('.model-mistral');
      const deepseekContainer = document.querySelector('.model-deepseek');
      
      // Verdict UI
      const verdictBadge = document.getElementById('verdict-badge');
      const confidenceLevel = document.getElementById('confidence-level');
      const confidenceText = document.getElementById('confidence-text');
      const modelInfo = document.getElementById('model-info');
      
      // Pre-fetch model metadata to show training ages
      fetchModelMetadata();
      
      async function fetchModelMetadata() {
        try {
          const response = await fetch('/static/model_metadata.json');
          if (response.ok) {
            const data = await response.json();
            updateModelInfo(data);
          }
        } catch (error) {
          console.error('Error fetching model metadata:', error);
        }
      }
      
      function updateModelInfo(data) {
        if (data && data.models) {
          let infoText = "Models trained on data up to: ";
          const modelInfos = [];
          const currentYear = new Date().getFullYear();
          
          for (const [modelId, modelData] of Object.entries(data.models)) {
            let trainingAge = "N/A";
            const cutoffYearMatch = modelData.training_cutoff?.match(/\d{4}/);
            if (cutoffYearMatch) {
              const cutoffYear = parseInt(cutoffYearMatch[0]);
              trainingAge = currentYear - cutoffYear;
            }
            
            // Build a short summary for the footer
            modelInfos.push(
              `${modelData.name} (Cutoff: ${modelData.training_cutoff}, Age: ${trainingAge} yrs)`
            );
            
            // Insert training age text into the card
            let elementId = "";
            if (modelId === "gpt-4o") elementId = "gpt-training-age";
            else if (modelId === "claude-3") elementId = "claude-training-age";
            else if (modelId === "mistral") elementId = "mistral-training-age";
            else if (modelId === "deepseek") elementId = "deepseek-training-age";
            
            if (elementId) {
              const elem = document.getElementById(elementId);
              if (elem) {
                elem.textContent = `Training Age: ${trainingAge} yrs`;
              }
            }
          }
          modelInfo.textContent = infoText + modelInfos.join(' â€¢ ');
        }
      }

      // Handle query submission
      queryForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const query = document.getElementById('query').value.trim();
        if (!query) return;
        
        resultsSection.classList.add('hidden');
        loadingSection.classList.remove('hidden');
        
        // Hide model containers
        [gptContainer, claudeContainer, mistralContainer, deepseekContainer].forEach(
          c => c.classList.add('hidden')
        );
        
        fetch('/ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query })
        })
        .then(response => response.json())
        .then(data => {
          claimText.textContent = data.query;
          
          // GPT
          if (data.responses['gpt-4o']?.success) {
            gptContainer.classList.remove('hidden');
            gptResponse.textContent = data.responses['gpt-4o'].content;
            gptResponse.classList.remove('text-red-400');
          } else {
            gptResponse.textContent = 'Error retrieving response.';
            gptResponse.classList.add('text-red-400');
          }
          
          // Claude
          if (data.responses['claude-3']?.success) {
            claudeContainer.classList.remove('hidden');
            claudeResponse.textContent = data.responses['claude-3'].content;
            claudeResponse.classList.remove('text-red-400');
          } else {
            claudeResponse.textContent = 'Error retrieving response.';
            claudeResponse.classList.add('text-red-400');
          }
          
          // Mistral
          if (data.responses['mistral']?.success) {
            mistralContainer.classList.remove('hidden');
            mistralResponse.textContent = data.responses['mistral'].content;
            mistralResponse.classList.remove('text-red-400');
          } else {
            mistralResponse.textContent = 'Error retrieving response.';
            mistralResponse.classList.add('text-red-400');
          }
          
          // DeepSeek
          if (data.responses['deepseek']?.success) {
            deepseekContainer.classList.remove('hidden');
            deepseekResponse.textContent = data.responses['deepseek'].content;
            deepseekResponse.classList.remove('text-red-400');
          } else {
            deepseekResponse.textContent = 'Error retrieving response.';
            deepseekResponse.classList.add('text-red-400');
          }
          
          // If there's an analysis object, use it to update verdict/confidence
          if (data.analysis) {
            updateVerdict(data.analysis);
          } else {
            // fallback
            updateVerdict({ verdict: 'UNCERTAIN', confidence_percentage: 50, confidence_level: 'MEDIUM' });
          }
          
          loadingSection.classList.add('hidden');
          resultsSection.classList.remove('hidden');
        })
        .catch(error => {
          console.error('Error:', error);
          loadingSection.classList.add('hidden');
          alert('An error occurred while processing your request.');
        });
      });

      function updateVerdict(analysis) {
        verdictBadge.textContent = analysis.verdict;
        verdictBadge.className = 'px-3 py-1 rounded-full text-white text-sm font-medium mr-3';
        
        if (analysis.verdict === 'TRUE') {
          verdictBadge.classList.add('bg-green-500');
        } else if (analysis.verdict === 'FALSE') {
          verdictBadge.classList.add('bg-red-500');
        } else {
          verdictBadge.classList.add('bg-yellow-500');
        }
        
        // Uppercase the confidence level text for emphasis
        confidenceText.textContent = analysis.confidence_level.toUpperCase() + ' Confidence';
        
        // Update confidence bar
        confidenceLevel.style.width = analysis.confidence_percentage + '%';
        confidenceLevel.className = 'confidence-level';
        
        if (analysis.confidence_percentage >= 70) {
          confidenceLevel.classList.add('truth-high');
        } else if (analysis.confidence_percentage >= 40) {
          confidenceLevel.classList.add('truth-medium');
        } else {
          confidenceLevel.classList.add('truth-low');
        }
      }

      newQueryBtn.addEventListener('click', function() {
        resultsSection.classList.add('hidden');
        document.getElementById('query').value = '';
        document.getElementById('query').focus();
      });
    });
  </script>
</body>
</html>